import org.zalando.ceylon_stups.helloWorldApi {
	toJson
}
shared interface CustomJsonable {
	shared formal String json;
}
shared class JSMap({<String->Jsonable>*} entries)
		satisfies CustomJsonable {
	shared actual String json => entries.map<String>((String->Jsonable entry) => quote(entry.key) + ": " + toJson(entry.item)).string;
}
shared class JSArray(shared {Jsonable*} array)
		satisfies CustomJsonable {
	shared actual String json => "[ " + ", ".join(array.map(toJson)) + " ]";
}

shared alias Jsonable => CustomJsonable|String|Integer|Float|Null;

String quote(String string) {
	return "\"" + string.replace("""\""", """\\""").replace(""""""", """\"""") + "\"";
}

shared String toJson(Jsonable jsonable) {
	switch (jsonable)
	case (is CustomJsonable) { return jsonable.json; }
	case (is String) { return quote(jsonable); }
	case (is Integer|Float) { return jsonable.string; }
	case (is Null) { return "null"; }
}
